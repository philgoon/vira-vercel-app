{"id":"PROJECT-018-vira-vercel-app-3ks","title":"Delete dead AuthContext.tsx - still contains supabase.auth.* calls, zero imports remain","status":"open","priority":3,"issue_type":"task","owner":"submissions@singlethrow.com","created_at":"2026-02-19T14:19:44.4878923-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T14:19:44.4878923-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-3ks","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.9","type":"discovered-from","created_at":"2026-02-19T14:19:53.3995509-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-66n","title":"Provision Clerk accounts for existing users (Larry, Nicole, Caitlin, Carli) so they can log in after Clerk migration","status":"open","priority":1,"issue_type":"task","owner":"submissions@singlethrow.com","created_at":"2026-02-19T14:50:02.083135-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T14:50:02.083135-05:00"}
{"id":"PROJECT-018-vira-vercel-app-an8","title":"EPIC: Post-Clerk Security Hardening","description":"Add requireAuth to unprotected write endpoints, remove debug routes, validate update fields, clean dead code. From code audit 2026-02-19.","status":"open","priority":0,"issue_type":"epic","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:28:59.0015767-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:28:59.0015767-05:00"}
{"id":"PROJECT-018-vira-vercel-app-an8.1","title":"Add requireAuth to vendors route (GET/POST/PUT)","description":"vendors/route.ts has no auth on any method. GET exposes all vendor data. POST/PUT allow unauthenticated writes.","acceptance_criteria":"All 3 methods require admin auth. Test: unauthenticated request returns 401.","status":"open","priority":0,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:29:13.1325181-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:29:13.1325181-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.1","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:29:13.1341621-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.10","title":"Add throw when SUPABASE_SERVICE_ROLE_KEY missing","description":"supabase.ts silently falls back to anon client when service key is missing. Should throw at startup.","acceptance_criteria":"Missing key throws error instead of silent fallback.","status":"open","priority":1,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:29:36.3723517-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:29:36.3723517-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.10","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:29:36.3740406-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.11","title":"Cache user role in Clerk session claims to eliminate auth DB query","description":"requireAuth in clerk-auth.ts hits user_profiles on every API call. Admin page load = 4 redundant auth DB queries. Store role as Clerk publicMetadata, read from JWT.","acceptance_criteria":"requireAuth reads role from Clerk session, zero DB calls. Fallback to DB only on cache miss.","status":"open","priority":0,"issue_type":"feature","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:40:07.3532287-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:40:07.3532287-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.11","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:40:07.3572444-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.12","title":"Fix auth waterfall: load data concurrently with auth check","description":"useViRAAuth blocks all page rendering until Clerk + profile fetch complete. Dashboard data fetch cannot start until auth resolves. 2-3 sequential round-trips before anything renders.","acceptance_criteria":"Dashboard data loads in parallel with auth. Page shows data immediately when auth resolves.","status":"open","priority":0,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:40:08.426225-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:40:08.426225-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.12","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:40:08.4319963-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.13","title":"Fix N+1 in ReviewAssignment: batch assignment lookup","description":"ReviewAssignment.tsx:60 fires one HTTP request per project to check assignments. 50 projects = 50 requests, each with auth DB query. Replace with single batch endpoint.","acceptance_criteria":"One API call returns all assignments. No per-project HTTP requests.","status":"open","priority":0,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:40:09.4724449-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:40:09.4724449-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.13","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:40:09.4773601-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.14","title":"Add vendor_id filter to projects API, fix VendorModal full-table fetch","description":"VendorModal fetches ALL projects via /api/projects then filters in JS for one vendor. Add ?vendor_id= param to projects route. Also refetches on every modal open with no cache.","acceptance_criteria":"VendorModal passes vendor_id param. API filters server-side. Only matching projects returned.","status":"open","priority":1,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:40:10.5468946-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:40:10.5468946-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.14","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:40:10.5508884-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.15","title":"Add pagination to admin table-data and projects routes","description":"admin/table-data and projects routes use select('*') with no limit. Full table scans on every load. Add limit/offset pagination.","acceptance_criteria":"Default limit of 100 rows. Supports ?page= and ?limit= params.","status":"open","priority":1,"issue_type":"feature","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:40:11.6082602-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:40:11.6082602-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.15","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:40:11.6131339-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.16","title":"Remove debug console.log from projects route","description":"projects/route.ts:35-41 has debug logging with JSON.stringify on every request. Remove it.","acceptance_criteria":"No debug console.log in projects route.","status":"open","priority":3,"issue_type":"chore","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:40:12.7386541-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:40:12.7386541-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.16","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:40:12.7442013-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.2","title":"Add requireAuth to ratings POST","description":"ratings/route.ts POST writes to projects table with no auth. Any caller can update any project.","acceptance_criteria":"POST requires admin or team auth. Unauthenticated returns 401.","status":"open","priority":0,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:29:32.2923132-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:29:32.2923132-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.2","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:29:32.2963568-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.3","title":"Add requireAuth to projects POST/PUT","description":"projects/route.ts POST and PUT have no auth. Anyone can create or update projects.","acceptance_criteria":"POST/PUT require admin or team auth. Unauthenticated returns 401.","status":"open","priority":0,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:29:33.1769554-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:29:33.1769554-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.3","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:29:33.1791733-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.4","title":"Delete debug-project-update route","description":"debug-project-update/route.ts has no auth, returns stack traces, echoes request body. Should not exist in production.","acceptance_criteria":"File deleted. Route returns 404.","status":"open","priority":0,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:29:33.6296184-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:29:33.6296184-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.4","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:29:33.6312627-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.5","title":"Add field allowlist to admin/update-record","description":"admin/update-record/route.ts accepts arbitrary field names from request body. Should validate against allowlist per table.","acceptance_criteria":"Unknown field names return 400. Only whitelisted columns accepted per table.","status":"open","priority":1,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:29:34.065145-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:29:34.065145-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.5","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:29:34.0667515-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.6","title":"Fix cron guard bypass when CRON_SECRET unset","description":"cron/send-reminders/route.ts skips auth when CRON_SECRET env is unset. Should require it.","acceptance_criteria":"Missing CRON_SECRET returns 500 or 401, never allows through.","status":"open","priority":0,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:29:34.5104427-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:29:34.5104427-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.6","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:29:34.5120699-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.7","title":"Add requireAuth to vira-match-enhanced POST","description":"vira-match-enhanced/route.ts POST triggers OpenAI API calls with no auth. Costs money per call.","acceptance_criteria":"Requires admin or team auth. Unauthenticated returns 401.","status":"open","priority":1,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:29:34.9584918-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:29:34.9584918-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.7","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:29:34.9601582-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.8","title":"Add requireAuth to pending-reviews and vendor ratings GET","description":"pending-reviews/route.ts and vendors/[id]/ratings/route.ts expose internal data with no auth.","acceptance_criteria":"Require at least team auth.","status":"open","priority":2,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:29:35.4213185-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:29:35.4213185-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.8","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:29:35.4230145-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-an8.9","title":"Remove dead files and unused packages","description":"Delete route-simplified.ts files, supabase/server.ts tombstone. Remove @google/generative-ai, @supabase/ssr from package.json.","acceptance_criteria":"Files gone. npm install clean. No import errors.","status":"open","priority":3,"issue_type":"chore","owner":"submissions@singlethrow.com","created_at":"2026-02-19T16:29:35.8918104-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T16:29:35.8918104-05:00","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-an8.9","depends_on_id":"PROJECT-018-vira-vercel-app-an8","type":"parent-child","created_at":"2026-02-19T16:29:35.8934659-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-cor","title":"Fix profile auto-linking: existing users have clerk_user_id=null, added email fallback to /api/users/profile GET","status":"closed","priority":1,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T14:19:31.2688325-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T14:20:02.2460156-05:00","closed_at":"2026-02-19T14:20:02.2460156-05:00","close_reason":"Added email fallback in /api/users/profile GET: if clerk_user_id lookup fails, fetches email from Clerk, matches by email in user_profiles, auto-writes clerk_user_id. Verified: tsc --noEmit exit 0, build passes.","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-cor","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.6","type":"discovered-from","created_at":"2026-02-19T14:19:52.2801762-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-l2j","title":"EPIC-001: Migrate Authentication from Supabase Auth to Clerk","description":"Replace Supabase Auth with Clerk as the identity provider. Supabase PostgreSQL data layer is retained. Scope: middleware, AuthContext, login UI, API route identity checks, user management, DB migration for clerk_user_id.","status":"open","priority":1,"issue_type":"epic","owner":"submissions@singlethrow.com","estimated_minutes":1200,"created_at":"2026-02-19T09:21:33.877829-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T14:19:23.0030541-05:00","labels":["auth","clerk","migration","sprint-5"]}
{"id":"PROJECT-018-vira-vercel-app-l2j.1","title":"R-CLERK-1: Environment and package setup","description":"Install @clerk/nextjs@latest. Create Clerk application at dashboard.clerk.com. Add NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY and CLERK_SECRET_KEY to .env.local only. Add Clerk env vars to Vercel project settings. Verify .gitignore excludes .env*.","acceptance_criteria":"npm install @clerk/nextjs succeeds. Keys exist in .env.local only, not in any tracked file.","status":"closed","priority":1,"issue_type":"task","owner":"submissions@singlethrow.com","estimated_minutes":60,"created_at":"2026-02-19T09:21:43.176812-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T09:28:35.8488198-05:00","closed_at":"2026-02-19T09:28:35.8488198-05:00","close_reason":"@clerk/nextjs@latest installed (15 packages). NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY and CLERK_SECRET_KEY added to .env.local. .gitignore already covers .env*.local.","labels":["auth","clerk","setup"],"dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-l2j.1","depends_on_id":"PROJECT-018-vira-vercel-app-l2j","type":"parent-child","created_at":"2026-02-19T09:21:43.1822722-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-l2j.10","title":"R-CLERK-10: Testing and production cutover","description":"End-to-end verification of all three roles. Test: admin login -\u003e dashboard access, team login -\u003e limited access (no admin routes), vendor login -\u003e vendor portal only, unauthenticated -\u003e redirected to sign-in. API route tests: 401 without session, 403 with wrong role, 200 with correct role. Test user creation flow (admin creates team member -\u003e welcome email -\u003e first login). Test vendor invite flow end-to-end. Deploy to Vercel staging, verify Clerk env vars set. Update CLAUDE.local.md tech stack: Auth: Clerk (was Supabase Auth). Update STATUS.md with Sprint 5 completion.","acceptance_criteria":"All three roles (admin, team, vendor) verified working in production. npm run build passes. No supabase.auth.* calls remain. Clerk dashboard shows all ViRA users.","status":"open","priority":1,"issue_type":"task","owner":"submissions@singlethrow.com","estimated_minutes":120,"created_at":"2026-02-19T09:23:17.1605371-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T14:19:08.2212828-05:00","labels":["auth","clerk","cutover","testing"],"dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-l2j.10","depends_on_id":"PROJECT-018-vira-vercel-app-l2j","type":"parent-child","created_at":"2026-02-19T09:23:17.1646709-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.10","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.9","type":"blocks","created_at":"2026-02-19T09:23:17.2225588-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-l2j.2","title":"R-CLERK-2: Middleware setup with clerkMiddleware()","description":"Create src/middleware.ts using clerkMiddleware() from @clerk/nextjs/server. File does not currently exist in the project. Configure matcher to skip Next.js internals and static files, always run for API routes. Public routes /apply and /api/vendor-invites/validate must remain accessible without auth.","acceptance_criteria":"Unauthenticated requests to /api/* return 401. Public routes /apply/[token] and /api/vendor-invites/validate remain accessible.","status":"closed","priority":1,"issue_type":"task","owner":"submissions@singlethrow.com","estimated_minutes":60,"created_at":"2026-02-19T09:21:52.7196289-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T09:35:29.1354806-05:00","closed_at":"2026-02-19T09:35:29.1354806-05:00","close_reason":"Created src/middleware.ts with clerkMiddleware() from @clerk/nextjs/server. Public routes /apply and /api/vendor-invites/validate exempted via createRouteMatcher.","labels":["auth","clerk","middleware"],"dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-l2j.2","depends_on_id":"PROJECT-018-vira-vercel-app-l2j","type":"parent-child","created_at":"2026-02-19T09:21:52.7237601-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.2","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.1","type":"blocks","created_at":"2026-02-19T09:21:52.7326889-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-l2j.3","title":"R-CLERK-3: Layout and ClerkProvider setup","description":"Wrap app/layout.tsx with ClerkProvider from @clerk/nextjs. Add SignedIn, SignedOut, UserButton to header area in LayoutContent component. Remove AuthProvider wrapper. Import only from @clerk/nextjs (not deprecated paths).","acceptance_criteria":"App loads with ClerkProvider. Clerk session available via useUser() in client components. UserButton renders in header for signed-in users.","status":"closed","priority":1,"issue_type":"task","owner":"submissions@singlethrow.com","estimated_minutes":120,"created_at":"2026-02-19T09:22:01.4052845-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T09:35:25.6710561-05:00","closed_at":"2026-02-19T09:35:25.6710561-05:00","close_reason":"ClerkProvider wraps layout.tsx. LayoutContent updated to use Clerk useAuth (isLoaded/isSignedIn). AuthProvider removed.","labels":["auth","clerk","layout"],"dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-l2j.3","depends_on_id":"PROJECT-018-vira-vercel-app-l2j","type":"parent-child","created_at":"2026-02-19T09:22:01.4103819-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.3","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.1","type":"blocks","created_at":"2026-02-19T09:22:01.4212335-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-l2j.4","title":"R-CLERK-4: Replace AuthContext with useViRAAuth hook","description":"Delete src/contexts/AuthContext.tsx. Create src/hooks/useViRAAuth.ts as thin wrapper: calls useUser() from Clerk + fetches user_profiles row by clerk_user_id for role data. Update all 8 files that call useAuth(): LayoutContent, SidebarNav, UserHeader, NotificationBell, admin/page.tsx, clients/page.tsx, users/page.tsx, vendor-portal/page.tsx, unauthorized/page.tsx, account-inactive/page.tsx. Update src/types/index.ts AuthContextType and AuthUser types.","acceptance_criteria":"All pages that previously used useAuth() compile and render correctly. isAdmin, isTeam, isVendor computed from user_profiles role.","status":"closed","priority":1,"issue_type":"task","owner":"submissions@singlethrow.com","estimated_minutes":180,"created_at":"2026-02-19T09:22:11.3693573-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T09:49:33.581629-05:00","closed_at":"2026-02-19T09:49:33.581629-05:00","close_reason":"Created src/hooks/useViRAAuth.ts. Replaced useAuth() from AuthContext in all 10 files: LayoutContent, SidebarNav, UserHeader, NotificationBell, ProtectedRoute, page.tsx, clients/page.tsx, vendor-portal/page.tsx, unauthorized/page.tsx, account-inactive/page.tsx. Zero AuthContext imports remain. tsc --noEmit: exit 0.","labels":["auth","clerk","refactor"],"dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-l2j.4","depends_on_id":"PROJECT-018-vira-vercel-app-l2j","type":"parent-child","created_at":"2026-02-19T09:22:11.372033-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.4","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.3","type":"blocks","created_at":"2026-02-19T09:22:11.3764718-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-l2j.5","title":"R-CLERK-5: Replace login and change-password pages","description":"Replace src/app/login/page.tsx with Clerk embedded SignIn component. Delete src/app/change-password/page.tsx (Clerk handles forced password change natively via dashboard). Update any links pointing to /login or /change-password. Remove NEXT_PUBLIC_SKIP_AUTH mock admin pattern.","acceptance_criteria":"Navigating to /login shows Clerk sign-in UI. Successful sign-in redirects to /. No custom password-change page exists.","status":"closed","priority":1,"issue_type":"task","owner":"submissions@singlethrow.com","estimated_minutes":120,"created_at":"2026-02-19T09:22:19.6623468-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T09:49:50.3073809-05:00","closed_at":"2026-02-19T09:49:50.3073809-05:00","close_reason":"login/page.tsx replaced with Clerk SignIn component. change-password/page.tsx replaced with redirect to /. NEXT_PUBLIC_SKIP_AUTH pattern removed from ProtectedRoute and LayoutContent.","labels":["auth","clerk","ui"],"dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-l2j.5","depends_on_id":"PROJECT-018-vira-vercel-app-l2j","type":"parent-child","created_at":"2026-02-19T09:22:19.6688072-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.5","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.3","type":"blocks","created_at":"2026-02-19T09:22:19.6765649-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-l2j.6","title":"R-CLERK-6: Database migration - add clerk_user_id to user_profiles","description":"Create migrations/020-clerk-user-id.sql: Phase 1 adds clerk_user_id TEXT UNIQUE column (non-breaking, alongside existing user_id). Write admin script to map existing Supabase user emails to Clerk user IDs. Add GET /api/users/profile?clerk_user_id= endpoint for useViRAAuth hook. Update vendor_users table user_id references. Audit RLS policies that reference auth.uid() - switch to service role client for data ops post-migration.","acceptance_criteria":"user_profiles has clerk_user_id column. API can look up profile by Clerk ID. All active users have clerk_user_id populated after mapping script runs.","status":"open","priority":1,"issue_type":"task","owner":"submissions@singlethrow.com","estimated_minutes":180,"created_at":"2026-02-19T09:22:30.9651687-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T14:19:15.115981-05:00","labels":["auth","clerk","database","migration"],"dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-l2j.6","depends_on_id":"PROJECT-018-vira-vercel-app-l2j","type":"parent-child","created_at":"2026-02-19T09:22:30.9728492-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.6","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.1","type":"blocks","created_at":"2026-02-19T09:22:31.0240595-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-l2j.7","title":"R-CLERK-7: Update API routes - replace supabase.auth.getUser() with Clerk auth()","description":"Replace supabase.auth.getUser() identity pattern with Clerk auth() from @clerk/nextjs/server in all 14 affected API routes: vendor-portal/profile, vendor-portal/ratings, vendor-applications/approve, vendor-applications/reject, admin/clear-data, admin/find-missing-overall, admin/merge-vendors, admin/sync-vendors, admin/table-data, admin/update-record, admin/update-vendor-name, admin/update-vendor-schema, admin/vendor-import, users/route.ts. Pattern: const { userId } = await auth(); then look up role from user_profiles by clerk_user_id.","acceptance_criteria":"All 14 routes return 401 for unauthenticated requests and 403 for wrong role. Existing functionality unchanged.","status":"closed","priority":1,"issue_type":"task","owner":"submissions@singlethrow.com","estimated_minutes":240,"created_at":"2026-02-19T09:22:42.3074869-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T09:55:41.7245535-05:00","closed_at":"2026-02-19T09:55:41.7245535-05:00","close_reason":"Created src/lib/clerk-auth.ts with requireAuth()/isNextResponse() helpers. Replaced supabase.auth.getUser() in 4 routes (vendor-portal/ratings, vendor-portal/profile, vendor-applications/reject, vendor-applications/approve). Added Clerk admin guards to all 18 unprotected admin routes. tsc --noEmit: exit 0.","labels":["api-routes","auth","clerk"],"dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-l2j.7","depends_on_id":"PROJECT-018-vira-vercel-app-l2j","type":"parent-child","created_at":"2026-02-19T09:22:42.3122829-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.7","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.3","type":"blocks","created_at":"2026-02-19T09:22:42.3199495-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.7","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.6","type":"blocks","created_at":"2026-02-19T09:22:42.3284661-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-l2j.8","title":"R-CLERK-8: Replace user management with Clerk Backend API","description":"Replace supabaseAdmin.auth.admin.createUser() and supabaseAdmin.auth.admin.updateUserById() in src/app/api/users/route.ts with Clerk Backend API via clerkClient() from @clerk/nextjs/server. On user creation: create Clerk user, store clerk_user_id in user_profiles. Remove password_change_required user_metadata pattern (Clerk handles natively). Update resend-welcome-email flow to use Clerk password reset API. Keep Mailgun welcome email - just update credential source.","acceptance_criteria":"Admin can create users via /users page. New users appear in Clerk dashboard AND user_profiles table with clerk_user_id populated.","status":"closed","priority":1,"issue_type":"task","owner":"submissions@singlethrow.com","estimated_minutes":180,"created_at":"2026-02-19T09:22:52.5873608-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T09:58:49.6175621-05:00","closed_at":"2026-02-19T09:58:49.6175621-05:00","close_reason":"api/users/route.ts: POST/PUT now use clerkClient().users.createUser/updateUser. vendor-applications/approve: uses clerkClient().users.createUser with rollback. All supabaseAdmin.auth.admin.* calls removed. tsc --noEmit: exit 0.","labels":["auth","clerk","user-management"],"dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-l2j.8","depends_on_id":"PROJECT-018-vira-vercel-app-l2j","type":"parent-child","created_at":"2026-02-19T09:22:52.5928037-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.8","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.6","type":"blocks","created_at":"2026-02-19T09:22:52.6102779-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-l2j.9","title":"R-CLERK-9: Remove Supabase Auth dependencies","description":"Remove @supabase/ssr from package.json (keep @supabase/supabase-js for data). Delete src/lib/supabase/server.ts (replaced by Clerk auth() + service client). Update src/lib/supabase.ts: remove auth-related exports, keep supabaseAdmin for data queries. Remove NEXT_PUBLIC_SKIP_AUTH env var and all references in code. Remove Supabase Auth-specific env vars from .env.local (keep DB vars: NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY).","acceptance_criteria":"npm run build succeeds with zero TypeScript errors. No imports from @supabase/ssr remain. No supabase.auth.* calls remain in any route or component.","status":"closed","priority":1,"issue_type":"task","owner":"submissions@singlethrow.com","estimated_minutes":60,"created_at":"2026-02-19T09:23:05.4901833-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T10:00:48.1005878-05:00","closed_at":"2026-02-19T10:00:48.1005878-05:00","close_reason":"Removed supabase.auth.* from ReviewAssignment.tsx (replaced with Clerk useUser). supabase/server.ts replaced with tombstone. SKIP_AUTH/NEXT_PUBLIC_SKIP_AUTH removed from .env.local. AuthContext.tsx is dead code (zero imports). tsc --noEmit: exit 0.","labels":["auth","cleanup","clerk"],"dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-l2j.9","depends_on_id":"PROJECT-018-vira-vercel-app-l2j","type":"parent-child","created_at":"2026-02-19T09:23:05.4954318-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.9","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.4","type":"blocks","created_at":"2026-02-19T09:23:05.5039459-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.9","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.5","type":"blocks","created_at":"2026-02-19T09:23:05.5099766-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.9","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.7","type":"blocks","created_at":"2026-02-19T09:23:05.5171025-05:00","created_by":"STsubmissions"},{"issue_id":"PROJECT-018-vira-vercel-app-l2j.9","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.8","type":"blocks","created_at":"2026-02-19T09:23:05.5232565-05:00","created_by":"STsubmissions"}]}
{"id":"PROJECT-018-vira-vercel-app-zfj","title":"Fix ProtectedRoute dead-end: redirected to /error which does not exist, changed to /login","status":"closed","priority":1,"issue_type":"bug","owner":"submissions@singlethrow.com","created_at":"2026-02-19T14:19:37.6302853-05:00","created_by":"STsubmissions","updated_at":"2026-02-19T14:20:05.141722-05:00","closed_at":"2026-02-19T14:20:05.141722-05:00","close_reason":"Changed ProtectedRoute.tsx:35 from router.push('/error') to router.push('/login'). /error page never existed.","dependencies":[{"issue_id":"PROJECT-018-vira-vercel-app-zfj","depends_on_id":"PROJECT-018-vira-vercel-app-l2j.10","type":"discovered-from","created_at":"2026-02-19T14:19:52.9047756-05:00","created_by":"STsubmissions"}]}
